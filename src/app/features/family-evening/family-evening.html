<div class="family-evening-container">
  <div class="fe-header-row">
    <h2>Family Evenings This Week</h2>
    <button class="add-btn-icon" (click)="openPlannerModal()" title="Add Family Evening">
      <span aria-hidden="true">+</span>
    </button>
  </div>
  <div class="suggestions-list">
    <div *ngFor="let evening of groupedEvenings()" class="task-card">
      <h4>{{ evening.title }}</h4>
      <ul>
        <li *ngFor="let task of evening.tasks">
          <span>{{ task.memberName }}</span> - <span>{{ task.details }}</span> <span class="task-date">({{ task.date | date:'shortDate' }})</span>
        </li>
      </ul>
    </div>
    <div *ngIf="groupedEvenings().length === 0" class="no-evenings">No family evenings for this week.</div>
  </div>

  <div class="planner-modal" *ngIf="showPlanner">
    <div class="modal-backdrop" (click)="closePlannerModal()"></div>
    <div class="modal-content centered">
      <h2>Family Evening Planner</h2>
      <form (submit)="submitIdea($event)">
        <label>
          Date:
          <input type="date" name="date" [(ngModel)]="date" required />
          <app-required-error-message *ngIf="submitted && !date" fieldName="Date" />
        </label>
        <label>
          Activity:
          <input type="text" name="activity" [(ngModel)]="idea" placeholder="e.g. Movie night, Board games" required />
          <app-required-error-message *ngIf="submitted && !idea" fieldName="Activity" />
        </label>
        <button type="submit">Suggest Family Evening</button>
        <button type="button" (click)="closePlannerModal()" style="margin-left: 12px;">Cancel</button>
      </form>
      <div class="suggestions-list">
  <div *ngFor="let task of tasks(); let i = index" class="task-card" (click)="editSuggestion(task, i)">
          <h4>{{ task.title }}</h4>
          <span class="task-type">{{ task.type }}</span>
          <p>{{ task.details }}</p>
          <div class="member-tags">
            <span *ngFor="let member of filteredMembers; let mi = index"
                  class="member-tag"
                  [class.assigned]="assignedMember[i] === member.email"
                  [ngStyle]="{'background-color': member.color || '#e0e7ff', 'color': member.color ? '#fff' : '#1e40af'}"
                  (click)="$event.stopPropagation(); assignTask(task, member, i)">
              {{ member.name }}
            </span>
          </div>
          <div *ngIf="assignedMember[i]" class="assigned-label">
            Assigned to: {{ getAssignedMemberName(i) }}
          </div>
        </div>
      </div>
      <div *ngIf="tasks().length > 0" style="margin-top: 20px; text-align: center;">
        <button type="button" class="fam-btn close-btn" (click)="closePlannerModal()">Saved & Close</button>
      </div>
    </div>
  </div>
</div>
