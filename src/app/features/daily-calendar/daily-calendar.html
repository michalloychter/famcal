<div class="daily-tasks-container main-div">
  <!-- Show member name as greeting -->
  <p class="userName">Hey {{ memberName() }},</p>

 <!-- Weather Forecast Section (New) -->
  <div class="weather-widget">
    <div><strong>Today's Weather</strong></div>
    
    <!-- FIX 1: Use the PUBLIC 'weatherData()' signal instead of the private 'weather()' -->
    <!-- FIX 2: Use an 'as weather' alias for clean access within the div -->
    <div *ngIf="weather() as weather" class="weather-info">
      <!-- Access properties directly from the 'weather' alias -->
      <div>{{ weather.city }}</div>
      <div>{{ weather.temp | number:'1.0-0' }}Â°C</div>
      <div>{{ weather.description }}</div>
      <!-- Use the alias here too -->
      <img [src]="weather.iconUrl" alt="{{ weather.description }} icon" />
    </div>

    <!-- FIX 3: Check weatherData() and weatherError() signals for loading/error states -->
    <div *ngIf="!weather() && !weatherError()" class="loading">
      Loading weather...
    </div>
    
    <!-- Check weatherError() signal value -->
    <div *ngIf="weatherError()" class="error-message">
      {{ weatherError() }}
    </div>

    <!-- Clothing Advice Section -->
    <div *ngIf="weather()" class="clothing-advice">
      <h4><i class="fa-solid fa-shirt"></i> What to Wear</h4>
      <div *ngIf="clothingLoading()" class="loading">Getting suggestions...</div>
      <p *ngIf="clothingAdvice() && !clothingLoading()" class="advice-text">{{ clothingAdvice() }}</p>
    </div>
  </div>

  <h3>Tasks for Today</h3>

  <ng-container *ngIf="tasks$ | async as tasks">
    <ng-container *ngIf="tasks.length > 0; else noTasks">
      <ul>
        <li *ngFor="let task of filterTasksForToday(tasks)" [ngClass]="'task type-' + mapTaskType(task.type)" [class.task-done]="task.done">
          <div class="task-content">
            <div class="task-member-name"><strong>{{ task.memberName }}</strong></div>
            <strong [class.task-title-done]="task.done">{{ task.title }}</strong>
            <p [class.task-text-done]="task.done">{{ task.details }}</p>
            <ng-container *ngIf="task.type === 'class'; else normalTask">
              <small [class.task-text-done]="task.done">
                Class on {{ getWeekdayName(task.weekday ?? 0) }}
                <span *ngIf="task.time">at {{ task.time }}</span>
              </small>
            </ng-container>
            <ng-template #normalTask>
              <small [class.task-text-done]="task.done">{{ task.date | friendlyDateTime }}</small>
            </ng-template>
            <button 
              class="done-tag" 
              [class.done-active]="task.done"
              (click)="toggleTaskDone(task)"
            >
              Done
            </button>
          </div>
        </li>
      </ul>
    </ng-container>
  </ng-container>

  <ng-template #noTasks>
    <p>No tasks scheduled for today.</p>
  </ng-template>
</div>